@model List<RandomMovieGenerator.Models.Movie>

@{
    ViewBag.Title = "Your Watchlist";
}

<div class="container mt-5">
    <h2 class="mb-4">Your Watchlist:</h2>
    @Html.AntiForgeryToken()


    @if (Model.Count == 0)
    {
        <p>No movies in your watchlist yet.</p>
    }
    else
    {
        <table class="table table-bordered table-striped" id="tabela1">
            <thead>
                <tr>
                    <th>Poster</th>
                    <th>Name</th>
                    <th>Release Year</th>
                    <th>Director</th>
                    <th>Duration</th>
                    <th>Genre</th>
                    <th>Rating</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var movie in Model)
                {
                    <tr>
                        <td>
                            <img src="@movie.ImageUrl" alt="@movie.Name" style="height: 100px;" />
                        </td>
                        <td>@movie.Name</td>
                        <td>@movie.ReleaseYear</td>
                        <td>@movie.Director</td>
                        <td>@movie.Duration</td>
                        <td>@movie.Genre</td>
                        <td>@movie.Rating</td>
                        <td>
                            <div class="text-center d-flex justify-content-center mb-3">
                                <button class="btn btn-success" type="submit" id="js-move" data-movie-id="@movie.Id">Move to Watched</button><hr />
                            </div>
                            <div class="text-center d-flex justify-content-center">
                                <button class="btn btn-danger" type="submit" id="js-delete" data-movie-id="@movie.Id">Remove</button>
                            </div>
                            
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    }
</div>

@section Scripts{

    <script>
        $(document).ready(function () {
            var table = $("#tabela1").DataTable({
                responsive: true,
                pagingType: "simple_numbers",
                language: {
                    paginate: {
                        previous: "Previous",
                        next: "Next"
                    }
                },
                initComplete: function () {
                    // Add margin to pagination buttons after initialization
                    $('.dataTables_paginate .paginate_button').css({
                        'margin': '0 6px',
                        'padding': '6px 12px',
                        'color': '#007bff'
                    });
                }
            });

            $("#tabela1 #js-delete").on("click", function (e) {
                e.preventDefault();
                var button = $(this);
                var movieId = button.attr("data-movie-id");
                var token = $('input[name="__RequestVerificationToken"]').val();
                bootbox.confirm("Are you sure you want to remove this movie from the watchlist?", function (result) {
                    if (result) {
                        $.ajax({
                            url: "/Home/RemoveFromWatchlist/" + movieId,
                            method: "POST",
                            data: {
                                movieId: movieId,
                                __RequestVerificationToken: token
                            },
                            success: function () {
                                table.row(button.parents("tr")).remove().draw();
                            },
                            error: function (err) {
                                console.log(err)
                            }
                        })
                    }
                })
            })
            $("#tabela1 #js-move").on("click", function (e) {
                e.preventDefault();
                var button = $(this);
                var movieId = button.attr("data-movie-id");
                var token = $('input[name="__RequestVerificationToken"]').val();
                bootbox.confirm("Are you sure you want to move this movie to the watched list?", function (result) {
                    if (result) {
                        $.ajax({
                            url: "/Home/MoveToWatched/" + movieId,
                            method: "POST",
                            data: {
                                movieId: movieId,
                                __RequestVerificationToken: token
                            },
                            success: function () {
                                table.row(button.parents("tr")).remove().draw();
                            },
                            error: function (err) {
                                console.log(err)
                            }
                        })
                    }
                })
            })
        })
    </script>
    
    
    }
